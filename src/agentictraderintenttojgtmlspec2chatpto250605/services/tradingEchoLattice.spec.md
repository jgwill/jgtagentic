
# Echo Lattice (Memory Crystallization) Service Specification

## 1. Purpose

The `Echo Lattice (Memory Crystallization)` service serves as the persistent memory and historical record for the entire "Trader Intent to Execution" lifecycle. It captures data from each stage of the process, from the initial trader narrative through LLM translation, spec parsing, JGTML execution core processing, campaign launching, trade execution, and subsequent outcomes and feedback. This "memory crystal" is foundational to the Echo Spiral concept, enabling learning, refinement, analysis, and the continuous improvement of both trading strategies and the automated translation process by recording outcomes and feedback.

## 2. Inputs (Data to be Logged)

The Lattice is primarily an input-driven system, designed to receive and store data from various other components.

*   **Trader Intent Data**:
    *   `narrative_id` (Unique identifier for this entire flow instance)
    *   `original_trader_narrative` (Text)
    *   `submission_timestamp`
    *   `trader_id` (Optional, if multi-user)
*   **LLM Translation Data**:
    *   `jgtml_spec_json` (The raw JSON spec generated by the LLM)
    *   `llm_model_used`
    *   `llm_prompt_version_or_hash`
    *   `llm_translation_timestamp`
    *   `llm_status` (Success/Failure, error messages)
*   **IntentSpecParser Data**:
    *   `parser_status` (Success/Failure)
    *   `validated_jgtml_spec_json`
    *   `parsing_timestamp`
*   **JGTML Execution Core Data**:
    *   `processed_signal_package_json` (Output from the execution core)
    *   `execution_core_status` (Success/Failure, error messages)
    *   `execution_core_timestamp`
*   **CampaignLauncher Data**:
    *   `launched_campaign_info` (Details of script/API call)
    *   `campaign_launch_status`
    *   `campaign_launch_timestamp`
*   **Trade Execution Data (From trading platform/broker)**:
    *   `trade_id`, `order_id`
    *   `instrument_traded`, `action_taken`
    *   `entry_price_actual`, `exit_price_actual`
    *   `quantity_filled`, `commission_paid`, `slippage_amount`
    *   `trade_entry_timestamp`, `trade_exit_timestamp`
    *   `profit_loss_amount`
    *   `trade_status` (e.g., Open, Closed, Rejected)
    *   `execution_feedback_from_platform`
*   **Market Context Data (Snapshots)**:
    *   Key market indicators/conditions at various stages.
*   **User Feedback Data (Manually or programmatically entered)**:
    *   `feedback_type` (e.g., "LLM_translation_quality", "signal_validity", "trade_outcome_review")
    *   `rating_score`, `qualitative_feedback_text`
    *   `suggested_improvements`
    *   `feedback_timestamp`

## 3. Processing Logic (Internal Operations)

1.  **Data Ingestion & Storage**:
    *   Provide secure API endpoints for other services to submit data.
    *   Validate incoming data.
    *   Store data in a structured, persistent database.
2.  **Data Linking & Correlation**:
    *   Establish relationships between all data pieces related to a single `narrative_id`.
3.  **Data Indexing**:
    *   Index key fields for efficient querying.
4.  **Data Archival & Retention Policies**.
5.  **API for Data Retrieval**:
    *   Provide query interfaces for accessing data.

## 4. Outputs

*   **A Persistent, Structured Data Store**: The "memory crystal" itself.
*   **Queryable API**: Enables access to stored data for:
    *   Analysis and reporting.
    *   Data for training/fine-tuning LLMs (feedback loop).
    *   Manual review.
*   **Derived Analytics (Potentially as a separate layer)**.

## 5. Key Considerations & Interactions

*   **Central Memory**: Critical for the learning and feedback aspects of the Echo Spiral.
*   **Schema Design**: Must be flexible and evolvable.
*   **Data Integrity & Consistency**.
*   **Scalability**.
*   **Security & Privacy**.
*   **Integration Points**: Interfaces with nearly every other component.
*   **Feedback Loop Enabler**: The core purpose is to store outcomes and feedback to enable:
    *   **Manual Refinement**: Traders review past performance.
    *   **Automated Refinement**: Data improves LLM prompts or JGTML core logic.
    *   **RLHF (Reinforcement Learning from Human Feedback)**.
*   **Data Versioning**.
*   **Asynchronous Data Ingestion**.
