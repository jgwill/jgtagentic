# EntryScriptGen Service Specification

## 1. Purpose

The `EntryScriptGen` service is responsible for translating the "Processed Signal Package" (generated by the `JGTML Signal Processing` service) into executable scripts. These scripts are designed to automate trade entry, place orders, or trigger alerts on specific trading platforms or through various execution APIs. It essentially converts high-level trading signals into low-level, platform-specific instructions.

## 2. Inputs

*   **Processed Signal Package**:
    *   The primary input, containing detailed information about active trading signals. This includes:
        *   `signal_name`, `instrument`, `timeframe`, `action` (BUY/SELL).
        *   `entry_price_target`, `stop_loss_target`, `take_profit_target`.
        *   Any other relevant parameters like lot size (if calculated upstream or configurable here), order type (market, limit), etc.
*   **Target Platform Configuration**:
    *   Specifies the desired output format or target execution environment. Examples:
        *   "MetaTrader 4 (MQL4)"
        *   "MetaTrader 5 (MQL5)"
        *   "Python_Binance_API"
        *   "Bash_Notification_Script"
        *   "TradingView_PineScript_Alert"
    *   This might include platform-specific templates or API endpoint details.
*   **User/Account Configuration (Potentially, managed securely)**:
    *   Account ID for trading.
    *   Risk management parameters (e.g., default lot size, risk percentage per trade, maximum drawdown). Some of these might be derived from the signal package itself.
    *   API keys or authentication credentials *if* this service is intended to embed them directly (less secure) or if it needs them to query account-specific information (e.g., current balance for position sizing). Ideally, sensitive credentials are managed by the execution environment itself.
*   **Script Templates (Optional)**:
    *   Pre-defined code templates for different target platforms, which this service would populate with signal-specific data.

## 3. Processing Logic (High-Level)

1.  **Initialization**:
    *   Load the "Processed Signal Package."
    *   Identify the target platform(s) from the configuration.
    *   Load any relevant script templates or platform-specific libraries.

2.  **Iterate Through Active Signals**:
    *   For each active signal in the "Processed Signal Package":
        *   **Parameter Mapping**: Extract relevant parameters (instrument, action, price levels, quantity/lot size) from the signal.
        *   **Platform-Specific Translation**:
            *   Based on the target platform, map the generic signal parameters to the specific syntax, functions, and structure required by that platform's scripting language or API.
            *   **Example (MQL4)**: Convert "EUR/USD, BUY, Entry: 1.0800, SL: 1.0750, TP: 1.0900" into MQL4 `OrderSend()` function calls with correct symbol, command, price, slippage, stoploss, takeprofit, magic number, etc.
            *   **Example (Python for Exchange API)**: Generate Python code using a library like `ccxt` or a specific exchange's SDK to place an order with the correct market symbol, side, type, quantity, and price.
            *   **Example (Bash for Notification)**: Create a bash script that uses `curl` to send an HTTP request to an alerting service, or uses `mail` to send an email.
        *   **Risk Management Integration**:
            *   Calculate position size based on risk parameters and account information (if available and configured).
            *   Ensure generated orders comply with defined risk limits.
        *   **Populate Template (if using templates)**: Fill in placeholders in the chosen script template with the signal's data.
        *   **Assemble Script**: Construct the final script code.

3.  **Script Aggregation/Packaging (Optional)**:
    *   If multiple signals are processed for the same platform, decide whether to generate individual scripts per signal or a single script that handles multiple signals (if the platform supports it).
    *   Package scripts with any necessary helper files or dependencies if required by the target environment.

## 4. Outputs

*   **Executable Scripts**:
    *   One or more files containing the generated code in the target platform's language (e.g., `.mq4`, `.py`, `.sh`, `.pine`).
    *   The content of these scripts will be the platform-specific instructions to execute the trade or alert.
*   **Manifest/Log File**:
    *   A file detailing which scripts were generated, for which signals, and for which target platforms.
    *   May include a summary of parameters used in each script.
*   **Status Report**:
    *   `status`: "Success", "Partial Success", "Failure".
    *   `message`: Details on the outcome, including any errors encountered during script generation (e.g., unsupported signal type for a platform, missing configuration).

## 5. Key Considerations & Interactions

*   **Target Platform Expertise**: Requires in-depth knowledge of the scripting languages, APIs, and nuances of each supported trading platform.
*   **Security**:
    *   Handling of API keys and sensitive trading parameters is critical. Scripts should not hardcode sensitive information if avoidable; prefer environment variables or secure credential management in the execution environment.
    *   Generated scripts should be reviewed if they have direct market execution capabilities.
*   **Modularity & Extensibility**:
    *   Design should allow for easy addition of new target platforms by adding new translators or templates.
*   **Error Handling**: Must handle cases like:
    *   Unsupported target platform.
    *   Missing parameters in the input signal package.
    *   Inconsistencies that prevent script generation.
*   **Idempotency (for orders)**: If scripts are for placing orders, consider how to prevent duplicate orders if a script is run multiple times (e.g., by using unique order identifiers or magic numbers).
*   **Testing**: Generated scripts ideally need to be tested in simulated or paper trading environments before live deployment.
*   **Upstream Dependency**: Relies entirely on the "Processed Signal Package" from the `JGTML Signal Processing` service.
*   **Downstream Interaction**: The generated scripts are intended for execution in their respective target environments. The outcome of these scripts (e.g., trade filled, error from platform) would then ideally be fed into the `Trading Echo Lattice`.
*   **Configuration Management**: Clear configuration for target platforms and any associated parameters (e.g., default slippage, order comment format) is essential.
